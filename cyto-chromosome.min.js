!function(){var t,e=new Object;"undefined"!=typeof module&&module.exports?(module.exports=e,t=require("d3")):(window.cyto_chr=e,t=window.d3),function(t,e){"use strict";t.margin={top:38,left:14,right:5};var r=248956422,n=1217e5,s=function(){this._segment="1",this._selectionMode="single",this._domTarget=e.select(document.documentElement),this._resolution="550",this._width=null,this._height=17,this._useRelative=!0,this._showAxis=!1,this.dispatch=e.dispatch("bandclick","selectorchange","selectorend","selectordelete"),this.rendered=!1,this.selectors=[],this.model=[],this.maxBasePair=0,this.xscale=e.scale.linear()};s.prototype.getMaxBasepair=function(){return this.maxBasePair},s.prototype.segment=function(e){return"number"==typeof e&&(e=e.toString()),t.InitGetterSetter.call(this,"_segment",e)},s.prototype.selectionMode=function(e){return t.InitGetterSetter.call(this,"_selectionMode",e)},s.prototype.target=function(r){if("string"==typeof r&&(r=e.select(r)),r.empty())throw"Error: Invalid dom target";return t.InitGetterSetter.call(this,"_domTarget",r)},s.prototype.resolution=function(e){if("number"==typeof e&&(e=e.toString()),"400"===e||"550"===e||"850"===e||"1200"===e||void 0===e)return t.InitGetterSetter.call(this,"_resolution",e);throw"Error: Invalid resolution. Please enter 400, 550, 850, or 1200 only."},s.prototype.width=function(e){return t.InitGetterSetter.call(this,"_width",e)},s.prototype.height=function(e){return t.InitGetterSetter.call(this,"_height",e)},s.prototype.useRelative=function(e){return t.InitGetterSetter.call(this,"_useRelative",e)},s.prototype.showAxis=function(e){return t.InitGetterSetter.call(this,"_showAxis",e)},s.prototype.on=function(t,e){if(!this.dispatch.hasOwnProperty(t))throw"Error: No event for "+t;this.dispatch.on(t,e)},s.prototype.config=function(t,e){return this[t](e)},s.prototype.renderAxis=function(){var r=e.svg.axis().scale(this.xscale).tickFormat(e.format("s")).orient("bottom");!this._useRelative||"Y"!==this._segment&&"22"!==this._segment&&"21"!==this._segment&&"20"!==this._segment&&"19"!==this._segment||r.ticks(6);var n=this.svgTarget.append("g").classed("bp-axis",!0).attr("transform","translate("+t.margin.left+","+(this._height+t.margin.top+6)+")");n.call(r),n.selectAll("text").style("font","10px sans-serif"),n.selectAll("path, line").style({fill:"none",stroke:"#666666","shape-rendering":"crispEdges"})},s.prototype.remove=function(){this.svgTarget.remove()},s.prototype.moveSelectorTo=function(t,e){if(2!==arguments.length)throw"Error moveSelectorTo: Invalid number of arguments. Both start and stop coordinates are required";0===this.selectors.length?this.newSelector(0,"10000000"):this.selectors[0].move(t,e)},s.prototype.newSelector=function(e,r){function n(t){s.dispatch.selectordelete(t);var e=s.selectors.indexOf(t);s.selectors.splice(e,1)}var s=this,i=t.selector(n).x(t.margin.left).y(t.margin.top-this._height/4).height(this._height+this._height/2).xscale(this.xscale).extent([e,r]).target(this.svgTarget).render();i.dispatch.on("change",function(t){s.dispatch.selectorchange(t)}),i.dispatch.on("changeend",function(t){s.dispatch.selectorend(t)}),this.selectors.push(i)},s.prototype.getSelections=function(){for(var t=[],e=0;e<this.selectors.length;e++){var r=this.selectors[e].extent();t.push({start:r[0],stop:r[1]})}return t},s.prototype.getSelectedBands=function(t){var e=[];if(this.selectors.length>0){var r=this.selectors[0].extent(),n=+r[0],s=+r[1];"undefined"!=typeof t&&(n-=t,s+=t),e=this.model.slice().filter(function(t){var e=+t.bp_start,r=+t.bp_stop;return n>=e&&r>n||s>e&&r>=s||e>=n&&s>=r?!0:!1})}return e},s.prototype.getSVGTarget=function(){return this.svgTarget},s.prototype.render=function(s){var i=this;if(i.rendered&&(i.selectors=[],i.remove()),null===i._width){var o=e.select(i._domTarget[0][0].parentNode).node().getBoundingClientRect().width;i.width(o)}return t.modelLoader.load(this._segment,this._resolution,function(o){function a(e){var r=0;return i.alignCentromere&&"1"!==i._segment&&(r=i.xscale(n)-i.xscale(i.segMid)),i.xscale(e)+t.margin.left+r}i.model=o,i.maxBasePair=e.max(o,function(t){return+t.bp_stop}),i.segMid=0;for(var l=0;l<o.length;l++)if("acen"===o[l].stain){i.segMid=o[l].bp_stop;break}var h=i._useRelative?i.maxBasePair/r*i._width:i._width;h-=t.margin.left+t.margin.right,i.xscale.domain(s?[s[0],s[1]]:[1,i.maxBasePair]),i.xscale.range([0,h]);var c=i._height+62,u=i._width;i.svgTarget=i._domTarget.style("height",c+"px").style("width",u+5+"px").append("svg").attr("width",u).attr("height",c);var p=i.svgTarget.selectAll("g").data(o).enter();i.svgTarget.append("text").text(i._segment).attr("x",5).attr("y",t.margin.top+i._height/2+2).attr("text-anchor","middle").style("font","10px sans-serif"),p.append("g").each(function(r,n){function s(){this.attr("stroke","#000000").attr("stroke-width",.2)}function l(e,r,n,s,o,l){return this.append("path").attr("d",t.roundedRect(a(e.bp_start),t.margin.top,a(e.bp_stop)-a(e.bp_start),i._height,r,n,s,o,l)).style("fill",t.getStainColour(e.stain,e.density))}var h=e.select(this),c="1200"===i._resolution?8:2;if(i._useRelative&&"1200"==i._resolution&&"Y"==i._segment&&(c=12),n%c===0){var u=(a(r.bp_stop)+a(r.bp_start))/2;h.append("line").attr("x1",u).attr("y1",t.margin.top).attr("x2",u).attr("y2",t.margin.top-4).style("stroke","grey").style("stroke-width",1),h.append("text").attr("transform","translate("+u+","+(t.margin.top-6)+")rotate(-50)").style("font","10px sans-serif").text(r.arm+r.band)}var p,d=a(r.bp_stop)-a(r.bp_start),g="1200"==i._resolution?7:6;if(0===n&&d>10)p=l.call(h,r,4,!0,!1,!0,!1),s.call(p);else if("acen"===r.stain&&d>g)"p"===r.arm?p=l.call(h,r,5,!1,!0,!1,!0):"q"===r.arm&&(p=l.call(h,r,5,!0,!1,!0,!1));else if(n===o.length-1)p=l.call(h,r,5,!1,!0,!1,!0),s.call(p);else{var f="stalk"===r.stain?t.margin.top+i._height/4:t.margin.top,_="stalk"===r.stain?i._height/2:i._height;p=h.append("rect").attr("x",a(r.bp_start)).attr("y",f).attr("height",_).attr("width",i.xscale(r.bp_stop)-i.xscale(r.bp_start)).style("fill",t.getStainColour(r.stain,r.density)),s.call(p)}p.append("title").text(r.arm+r.band),p.on("mouseover",function(r){var n=e.select(this).style("opacity","0.5").style("cursor","pointer");"gneg"===r.stain&&n.style("fill",t.getStainColour("gpos","25"))}),p.on("mouseout",function(r){var n=e.select(this).style("opacity","1").style("cursor","default");"gneg"===r.stain&&n.style("fill",t.getStainColour("gneg"))}),p.on("click",function(t){(0===i.selectors.length||"multi"===i._selectionMode&&e.event.altKey)&&i.newSelector(t.bp_start,t.bp_stop),"single"===i._selectionMode&&i.selectors.length>0&&i.moveSelectorTo(t.bp_start,t.bp_stop),i.dispatch.bandclick(t)})}),i._showAxis&&i.renderAxis(),i.rendered=!0}),i},t.chromosome=function(){return new s}}(e||{},t),function(t,e){function r(){this.status="notloaded",this.cache=[]}function n(t,r,n){var s=l[r];if(0===s.cache.length){if("loading"===s.status)return void h.push({res:r,cb:n});"notloaded"===s.status&&(s.status="loading",e.tsv(t,function(t){for(s.cache=t,s.status="loaded",n(t);h.length>0;){var e=h.shift();e.cb(t)}}))}else n(s.cache)}function s(t,e,r){t=t||"1",e=e||"550";var s=o[e];n(a+s,e,function(e){if(e){var n=i(e,t);r(n)}})}function i(t,e){for(var r=[],n=0;n<t.length;n++)t[n]["#chromosome"]===e&&r.push(t[n]);return r}var o={400:"ideogram_9606_GCF_000001305.14_400_V1",550:"ideogram_9606_GCF_000001305.14_550_V1",850:"ideogram_9606_GCF_000001305.14_850_V1",1200:"ideogram_9606_GCF_000001305.13_1200_v1"},a="data/",l={400:new r,550:new r,850:new r,1200:new r},h=[];t.modelLoader={load:s,setDataDir:function(t){a=t},getDataDir:function(){return a}}}(e||{},t),function(t,e){var r=function(t){this._brush=e.svg.brush(),this.dispatch=e.dispatch("change","changeend","selectordelete"),this._x=0,this._y=0,this._extent=[0,0],this._height=0,this._closecb=t};r.prototype.test=function(e){var r=this;return t.InitGetterSetter.call(this,"_test",e,function(){r._another="_that"})},r.prototype.extent=function(e){var r=this;return"undefined"==typeof e?r._brush.extent():t.InitGetterSetter.call(this,"_extent",e,function(){r._brush.extent(e)})},r.prototype.xscale=function(e){var r=this;return t.InitGetterSetter.call(this,"_xscale",e,function(){r._brush.x(e)})},r.prototype.target=function(e){return t.InitGetterSetter.call(this,"_target",e)},r.prototype.height=function(e){return t.InitGetterSetter.call(this,"_height",e)},r.prototype.x=function(e){return t.InitGetterSetter.call(this,"_x",e)},r.prototype.y=function(e){return t.InitGetterSetter.call(this,"_y",e)},r.prototype.render=function(){var r=this;this.selector=this._target.append("g").attr("transform","translate("+this._x+","+this._y+")").call(this._brush),this.selector.selectAll("rect").attr("height",this._height),this.selector.select(".background").remove();var n=(this.selector.select(".extent").style("fill","steelblue").style("opacity","0.5"),this._xscale(this._extent[1])+t.margin.left),s=t.margin.top-3,i=this._target.append("g");return i.append("title").text("remove"),this.deleteButton=i.append("circle").attr("cx",n).attr("cy",s).attr("r",5).attr("fill","red").on("mouseover",function(){e.select(this).style("cursor","pointer")}).on("mouseout",function(){e.select(this).style("cursor","default")}).on("click",function(){r.remove()}),this._brush.on("brush",function(){r.updateXButton();var t=r._brush.extent();r.dispatch.change(t)}),this._brush.on("brushend",function(t){var e=r._brush.extent();r.dispatch.changeend(e)}),this},r.prototype.remove=function(){return this.selector.remove(),this.deleteButton.remove(),this._closecb(this),this},r.prototype.updateXButton=function(){var e=this._brush.extent(),r=this._xscale(e[1])+t.margin.left;this.deleteButton.attr("cx",r)},r.prototype.move=function(t,e){this._brush.extent([t,e]),this.selector.call(this._brush),this.updateXButton()},t.selector=function(t){return new r(t)}}(e||{},t),function(t,e){t.initPattern=function(){var t=this.append("pattern").attr("id","acen-fill").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","10").attr("height","10").append("g").style({fill:"none",stroke:"#708090","stroke-width":"2"});t.append("path").attr("d","M0,0 l10,10"),t.append("path").attr("d","M10,0 l-10,10")},t.roundedRect=function(t,e,r,n,s,i,o,a,l){var h;return h="M"+(t+s)+","+e,h+="h"+(r-2*s),o?h+="a"+s+","+s+" 0 0 1 "+s+","+s:(h+="h"+s,h+="v"+s),h+="v"+(n-2*s),l?h+="a"+s+","+s+" 0 0 1 "+-s+","+s:(h+="v"+s,h+="h"+-s),h+="h"+(2*s-r),a?h+="a"+s+","+s+" 0 0 1 "+-s+","+-s:(h+="h"+-s,h+="v"+-s),h+="v"+(2*s-n),i?h+="a"+s+","+s+" 0 0 1 "+s+","+-s:(h+="v"+-s,h+="h"+s),h+="z"},t.getStainColour=function(t,e){if("gpos"===t){if(""===e||null===e)return"#000000";switch(e){case"100":return"#000000";case"75":return"#666666";case"50":return"#999999";case"25":return"#d9d9d9"}}return"gneg"===t?"#ffffff":"acen"===t?"#708090":"gvar"===t?"#e0e0e0":"stalk"===t?"#708090":"green"},t.setOption=function(t,e){return"undefined"!=typeof t?t:e},t.InitGetterSetter=function(t,e,r){return"undefined"!=typeof e?(this[t]=e,"function"==typeof r&&r(),this):this[t]}}(e||{},t),function(){"undefined"!=typeof angular&&(e.modelLoader.setDataDir("./node_modules/cyto-chromosome-vis/data/"),angular.module("cyto-chromosome-vis",[]).directive("cytochromosome",[function(){function r(r,n,s){s.resolution=e.setOption(s.resolution,"550"),s.width=e.setOption(s.width,1e3),s.segment=e.setOption(s.segment,"1"),s.useRelative=e.setOption(s.useRelative,!0),s.showAxis=e.setOption(s.showAxis,!1),e.chromosome().target(t.select(n[0])).width(s.width).segment(s.segment).resolution(s.resolution).useRelative("true"==s.useRelative).showAxis("true"==s.showAxis).render()}return{link:r,restrict:"E"}}]).provider("cytochromosome",function(){this.build=function(){return e.chromosome()},this.setDataDir=function(t){e.modelLoader.setDataDir(t)},this.$get=function(){return this}}))}()}();